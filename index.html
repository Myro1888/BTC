<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#0f172a">
<title>Bitcoin Bottom & Top Indicator</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{background:#0f172a;color:#e2e8f0;font-family:-apple-system,BlinkMacSystemFont,'SF Mono',monospace;line-height:1.5}
.container{max-width:600px;margin:0 auto;padding:16px}
.header{text-align:center;padding:20px 0;margin-bottom:20px}
.header h1{font-size:18px;color:#94a3b8;margin-bottom:8px}
.price{font-size:36px;font-weight:bold;color:#fff}
.price-sub{font-size:12px;color:#64748b;margin-top:4px}

/* Main Signal Card */
.signal-card{border-radius:16px;padding:32px 24px;margin-bottom:20px;text-align:center;border:3px solid}
.signal-card.buy{background:linear-gradient(135deg,rgba(34,197,94,0.15),rgba(34,197,94,0.05));border-color:#22c55e}
.signal-card.sell{background:linear-gradient(135deg,rgba(239,68,68,0.15),rgba(239,68,68,0.05));border-color:#ef4444}
.signal-card.neutral{background:linear-gradient(135deg,rgba(234,179,8,0.15),rgba(234,179,8,0.05));border-color:#eab308}
.signal-type{font-size:11px;text-transform:uppercase;letter-spacing:2px;margin-bottom:8px}
.signal-action{font-size:48px;font-weight:bold;margin-bottom:8px}
.signal-allocation{font-size:24px;margin-bottom:8px}
.signal-desc{font-size:13px;opacity:0.8}

/* Gauge */
.gauge{margin:24px auto;max-width:400px}
.gauge-bar{height:20px;background:linear-gradient(90deg,#22c55e 0%,#22c55e 30%,#eab308 30%,#eab308 70%,#ef4444 70%,#ef4444 100%);border-radius:10px;position:relative}
.gauge-needle{position:absolute;top:-6px;width:4px;height:32px;background:#fff;border-radius:2px;transform:translateX(-50%);box-shadow:0 0 10px rgba(255,255,255,0.8)}
.gauge-labels{display:flex;justify-content:space-between;font-size:10px;color:#64748b;margin-top:6px}
.gauge-value{font-size:12px;color:#94a3b8;margin-top:8px}

/* Indicators */
.indicators{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:20px}
.indicator{background:#1e293b;border:1px solid #334155;border-radius:12px;padding:16px;text-align:center}
.indicator.active-buy{border-color:#22c55e;background:rgba(34,197,94,0.1)}
.indicator.active-sell{border-color:#ef4444;background:rgba(239,68,68,0.1)}
.ind-name{font-size:10px;color:#64748b;text-transform:uppercase;margin-bottom:8px}
.ind-value{font-size:20px;font-weight:bold;margin-bottom:4px}
.ind-status{font-size:11px}

/* Buy/Sell Scores */
.scores{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:20px}
.score-card{border-radius:12px;padding:20px;text-align:center}
.score-card.buy-score{background:#1e293b;border:2px solid #22c55e}
.score-card.sell-score{background:#1e293b;border:2px solid #ef4444}
.score-label{font-size:10px;text-transform:uppercase;letter-spacing:1px;margin-bottom:8px}
.score-value{font-size:32px;font-weight:bold}
.score-max{font-size:12px;color:#64748b}

/* Historical */
.historical{background:#1e293b;border:1px solid #334155;border-radius:12px;padding:16px;margin-bottom:20px}
.hist-title{font-size:11px;color:#94a3b8;text-transform:uppercase;letter-spacing:1px;margin-bottom:12px;text-align:center}
.hist-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.hist-item{text-align:center}
.hist-label{font-size:9px;color:#64748b;margin-bottom:4px}
.hist-value{font-size:14px;font-weight:bold}

/* Ladder */
.ladder{background:#1e293b;border:1px solid #334155;border-radius:12px;padding:16px;margin-bottom:20px}
.ladder-title{font-size:11px;color:#94a3b8;text-transform:uppercase;letter-spacing:1px;margin-bottom:12px;text-align:center}
.ladder-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
.ladder-item{background:#0f172a;border-radius:8px;padding:12px;text-align:center}
.ladder-label{font-size:9px;color:#64748b;margin-bottom:4px}
.ladder-price{font-size:13px;font-weight:bold}
.ladder-pct{font-size:11px;margin-top:4px}

/* Footer */
.footer{text-align:center;padding:16px;font-size:10px;color:#475569;border-top:1px solid #334155}
.disclaimer{background:rgba(153,27,27,0.1);border:1px solid rgba(153,27,27,0.3);color:rgba(248,113,113,0.8);padding:12px;border-radius:8px;margin-bottom:12px}

@media(max-width:500px){
  .indicators,.scores,.hist-grid,.ladder-grid{grid-template-columns:1fr}
  .signal-action{font-size:36px}
}
</style>
</head>
<body>
<div id="app" style="display:flex;align-items:center;justify-content:center;min-height:100vh;color:#94a3b8">Loading...</div>
<script>
(function(){
var C={s:{},
set:function(k,v){this.s[k]={value:v,ts:Date.now()};try{localStorage.setItem('btc_'+k,JSON.stringify(this.s[k]))}catch(e){}},
get:function(k,m){m=m||3600000;if(this.s[k]&&(Date.now()-this.s[k].ts)<m)return this.s[k];try{var x=localStorage.getItem('btc_'+k);if(x){var p=JSON.parse(x);this.s[k]=p;if((Date.now()-p.ts)<m)return p}}catch(e){}return null},
any:function(k){if(this.s[k])return this.s[k];try{var x=localStorage.getItem('btc_'+k);if(x){var p=JSON.parse(x);this.s[k]=p;return p}}catch(e){}return null}
};

function fj(url,t){t=t||10000;return new Promise(function(ok,fail){var d=false,tm=setTimeout(function(){d=true;fail(new Error('timeout'))},t);fetch(url).then(function(r){clearTimeout(tm);if(d)return;if(!r.ok)throw new Error(r.status);return r.json()}).then(function(x){if(!d)ok(x)}).catch(function(e){clearTimeout(tm);if(!d)fail(e)})})}

function fetchPrice(){
  return fj('https://api.binance.com/api/v3/ticker/price?symbol=BTCUSDT').then(function(d){var p=parseFloat(d.price);if(p>0){C.set('price',p);return p}throw new Error()}).catch(function(){
    return fj('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd').then(function(d){var p=d.bitcoin.usd;C.set('price',p);return p}).catch(function(){
      var c=C.any('price');return c?c.value:0})})
}

function fetchMA(){
  var c=C.get('ma',86400000);if(c)return Promise.resolve(c.value);
  return fj('https://api.coingecko.com/api/v3/coins/bitcoin/market_chart?vs_currency=usd&days=1400&interval=weekly',45000).then(function(d){
    var p=d.prices;if(!p||p.length<100)throw new Error();
    var s=0;for(var i=p.length-200;i<p.length;i++)s+=p[i][1];
    var ma=s/200;C.set('ma',ma);return ma;
  }).catch(function(){
    return fj('https://api.binance.com/api/v3/klines?symbol=BTCUSDT&interval=1w&limit=200',15000).then(function(d){
      var s=0;for(var i=0;i<d.length;i++)s+=parseFloat(d[i][4]);
      var ma=s/d.length;C.set('ma',ma);return ma;
    })
  }).catch(function(){var c=C.any('ma');return c?c.value:0})
}

function fetchFG(){
  var c=C.get('fg',86400000);if(c)return Promise.resolve(c.value);
  return fj('https://api.alternative.me/fng/?limit=1').then(function(d){var v=parseInt(d.data[0].value);C.set('fg',v);return v}).catch(function(){var c=C.any('fg');return c?c.value:50})
}

function fetchFR(){
  var c=C.get('fr',300000);if(c)return Promise.resolve(c.value);
  return fj('https://fapi.binance.com/fapi/v1/fundingRate?symbol=BTCUSDT&limit=1').then(function(d){var r=parseFloat(d[0].fundingRate);C.set('fr',r);return r}).catch(function(){var c=C.any('fr');return c?c.value:0})
}

function fetchHR(){
  var c=C.get('hr',3600000);if(c)return Promise.resolve(c.value);
  return fj('https://mempool.space/api/v1/mining/hashrate/1y',20000).then(function(d){
    if(!d.hashrates||d.hashrates.length<60)throw new Error();
    var h=d.hashrates,s3=0,s6=0;
    for(var i=h.length-30;i<h.length;i++)s3+=h[i].avgHashrate;
    for(var i=h.length-60;i<h.length;i++)s6+=h[i].avgHashrate;
    var cap=(s3/30)<(s6/60);C.set('hr',cap);return cap;
  }).catch(function(){var c=C.any('hr');return c?c.value:false})
}

function fetchRSI(){
  var c=C.get('rsi',3600000);if(c)return Promise.resolve(c.value);
  return fj('https://api.binance.com/api/v3/klines?symbol=BTCUSDT&interval=1d&limit=30',15000).then(function(d){
    var closes=d.map(function(k){return parseFloat(k[4])});
    var gains=[],losses=[];
    for(var i=1;i<closes.length;i++){
      var chg=closes[i]-closes[i-1];
      gains.push(chg>0?chg:0);
      losses.push(chg<0?-chg:0);
    }
    var avgG=0,avgL=0;
    for(var i=gains.length-14;i<gains.length;i++){avgG+=gains[i];avgL+=losses[i];}
    avgG/=14;avgL/=14;
    var rsi=avgL===0?100:100-(100/(1+(avgG/avgL)));
    C.set('rsi',rsi);return rsi;
  }).catch(function(){var c=C.any('rsi');return c?c.value:50})
}

// Scoring functions
function calcBuyScore(price,ma,fg,hr,fr){
  var score=0,indicators=[];

  // 1. Price vs 200W MA (40 pts) - MOST CRITICAL for bottom detection
  // True bottoms only occur AT or BELOW the 200W MA
  var pct=ma>0?((price-ma)/ma)*100:0;
  var pdPts=pct<=-30?40:pct<=-20?35:pct<=-10?28:pct<=0?20:pct<=15?8:pct<=30?3:0;
  score+=pdPts;
  indicators.push({name:'Price vs 200W MA',value:(pct>=0?'+':'')+pct.toFixed(0)+'%',pts:pdPts,max:40,buy:pct<=15,status:pct<=-20?'DEEP VALUE':pct<=0?'UNDERVALUED':pct<=30?'FAIR VALUE':'OVERVALUED'});

  // 2. Fear & Greed (20 pts) - but only counts if price is reasonable
  var fgPts=fg<=10?20:fg<=20?16:fg<=30?12:fg<=40?6:0;
  // Discount F&G points if price is way above MA (fear at $100k is not same as fear at $20k)
  if(pct>50)fgPts=Math.round(fgPts*0.25);
  else if(pct>30)fgPts=Math.round(fgPts*0.5);
  score+=fgPts;
  indicators.push({name:'Fear & Greed',value:fg,pts:fgPts,max:20,buy:fg<=30&&pct<=30,status:fg<=20?'EXTREME FEAR':fg<=40?'FEAR':'NEUTRAL/GREED'});

  // 3. Hash Ribbons (25 pts) - miner capitulation, but discounted if price elevated
  var hrPts=hr?25:0;
  // Miner stress at $100k is different than at $20k
  if(pct>50)hrPts=Math.round(hrPts*0.25);
  else if(pct>30)hrPts=Math.round(hrPts*0.5);
  score+=hrPts;
  indicators.push({name:'Hash Ribbons',value:hr?'CAPITULATION':'Recovery',pts:hrPts,max:25,buy:hr&&pct<=30,status:hr?'MINERS STRESSED':'MINERS OK'});

  // 4. Funding Rate (15 pts) - also discounted if price elevated
  var frPct=fr*100;
  var frPts=frPct<=-0.03?15:frPct<=-0.01?10:frPct<0?5:0;
  if(pct>50)frPts=Math.round(frPts*0.25);
  else if(pct>30)frPts=Math.round(frPts*0.5);
  score+=frPts;
  indicators.push({name:'Funding Rate',value:(frPct>=0?'+':'')+frPct.toFixed(3)+'%',pts:frPts,max:15,buy:frPct<0&&pct<=30,status:frPct<-0.01?'SHORTS PAYING':frPct<0.02?'NEUTRAL':'LONGS PAYING'});

  return{score:score,max:100,indicators:indicators,pricePct:pct};
}

function calcSellScore(price,ma,fg,fr,rsi){
  var score=0,indicators=[];

  // 1. Price vs 200W MA (40 pts) - MOST CRITICAL for top detection
  var pct=ma>0?((price-ma)/ma)*100:0;
  var pdPts=pct>=150?40:pct>=100?35:pct>=70?25:pct>=50?15:pct>=30?5:0;
  score+=pdPts;
  indicators.push({name:'Price vs 200W MA',value:(pct>=0?'+':'')+pct.toFixed(0)+'%',pts:pdPts,max:40,sell:pct>=50,status:pct>=100?'EXTREME HIGH':pct>=50?'ELEVATED':'NORMAL'});

  // 2. Fear & Greed (20 pts) - but discounted if price is low
  var fgPts=fg>=90?20:fg>=80?16:fg>=70?12:fg>=60?6:0;
  // Greed at low prices is less concerning
  if(pct<0)fgPts=Math.round(fgPts*0.25);
  else if(pct<30)fgPts=Math.round(fgPts*0.5);
  score+=fgPts;
  indicators.push({name:'Fear & Greed',value:fg,pts:fgPts,max:20,sell:fg>=70&&pct>=30,status:fg>=80?'EXTREME GREED':fg>=60?'GREED':'NEUTRAL/FEAR'});

  // 3. RSI (25 pts) - discounted if price is low
  var rsiPts=rsi>=85?25:rsi>=75?20:rsi>=70?12:rsi>=65?5:0;
  if(pct<0)rsiPts=Math.round(rsiPts*0.25);
  else if(pct<30)rsiPts=Math.round(rsiPts*0.5);
  score+=rsiPts;
  indicators.push({name:'RSI (14)',value:rsi.toFixed(0),pts:rsiPts,max:25,sell:rsi>=70&&pct>=30,status:rsi>=80?'OVERBOUGHT':rsi>=65?'HIGH':'NORMAL'});

  // 4. Funding Rate (15 pts) - discounted if price is low
  var frPct=fr*100;
  var frPts=frPct>=0.08?15:frPct>=0.05?12:frPct>=0.03?8:frPct>=0.02?4:0;
  if(pct<0)frPts=Math.round(frPts*0.25);
  else if(pct<30)frPts=Math.round(frPts*0.5);
  score+=frPts;
  indicators.push({name:'Funding Rate',value:(frPct>=0?'+':'')+frPct.toFixed(3)+'%',pts:frPts,max:15,sell:frPct>=0.03&&pct>=30,status:frPct>=0.05?'OVERLEVERAGED':frPct>=0.02?'ELEVATED':'NORMAL'});

  return{score:score,max:100,indicators:indicators,pricePct:pct};
}

function getSignal(buyScore,sellScore,pricePct){
  // Price position is the most important factor
  // Can't have a "bottom" when price is 50%+ above 200W MA
  // Can't have a "top" when price is below 200W MA

  // ═══════ SELL SIGNALS (Conservative - 90%+ accuracy target) ═══════

  // STRONG SELL: Only at extreme levels (historically 100% accurate)
  // Requires: >100% above MA OR (>70% above MA AND score >= 85)
  if(pricePct>=100 && sellScore>=70){
    return{type:'sell',action:'STRONG SELL',alloc:100,desc:'Extreme overvaluation - exit most positions',color:'#ef4444'};
  }
  if(pricePct>=70 && sellScore>=85){
    return{type:'sell',action:'STRONG SELL',alloc:100,desc:'Major top indicators - exit positions',color:'#ef4444'};
  }

  // SELL: High conviction but not extreme
  if(pricePct>=70 && sellScore>=60){
    return{type:'sell',action:'SELL',alloc:75,desc:'Elevated risk - significant profit taking',color:'#ef4444'};
  }
  if(pricePct>=50 && sellScore>=70){
    return{type:'sell',action:'SELL',alloc:75,desc:'High valuation with greed - take profits',color:'#ef4444'};
  }

  // REDUCE: Moderate caution
  if(pricePct>=50 && sellScore>=40){
    return{type:'sell',action:'REDUCE',alloc:50,desc:'Above fair value - consider taking some profits',color:'#fb923c'};
  }
  if(pricePct>=30 && sellScore>=50){
    return{type:'sell',action:'REDUCE',alloc:35,desc:'Getting extended - trim positions',color:'#fb923c'};
  }

  // ═══════ NEUTRAL ZONE (30-50% above MA) ═══════
  if(pricePct>30){
    if(buyScore>=50)return{type:'neutral',action:'HOLD',alloc:0,desc:'Mixed signals - maintain positions',color:'#eab308'};
    return{type:'neutral',action:'HOLD',alloc:0,desc:'No strong signal - hold positions',color:'#eab308'};
  }

  // ═══════ BUY SIGNALS ═══════

  // Fair value range (0-30% above MA)
  if(pricePct>0){
    if(buyScore>=60)return{type:'buy',action:'BUY',alloc:50,desc:'Good value with fear - accumulate',color:'#22c55e'};
    if(buyScore>=45)return{type:'buy',action:'ACCUMULATE',alloc:35,desc:'Fair value - steady buying',color:'#86efac'};
    if(sellScore>=50)return{type:'sell',action:'REDUCE',alloc:35,desc:'Some profit taking warranted',color:'#fb923c'};
    return{type:'neutral',action:'HOLD',alloc:0,desc:'Fair value zone - hold',color:'#eab308'};
  }

  // Undervalued (0 to -20% below MA)
  if(pricePct>-20){
    if(buyScore>=60)return{type:'buy',action:'STRONG BUY',alloc:75,desc:'Undervalued with fear - strong accumulation',color:'#22c55e'};
    if(buyScore>=45)return{type:'buy',action:'BUY',alloc:60,desc:'Below fair value - buy the dip',color:'#22c55e'};
    if(buyScore>=30)return{type:'buy',action:'ACCUMULATE',alloc:40,desc:'Good entry zone - steady buying',color:'#86efac'};
    return{type:'neutral',action:'HOLD',alloc:0,desc:'Undervalued but no fear - hold',color:'#eab308'};
  }

  // Deeply undervalued (>20% below MA) - Maximum opportunity
  if(buyScore>=60)return{type:'buy',action:'STRONG BUY',alloc:100,desc:'Maximum opportunity - deploy all capital',color:'#22c55e'};
  if(buyScore>=45)return{type:'buy',action:'STRONG BUY',alloc:85,desc:'Deep value with fear - aggressive buying',color:'#22c55e'};
  if(buyScore>=30)return{type:'buy',action:'BUY',alloc:65,desc:'Deep value zone - strong accumulation',color:'#22c55e'};
  return{type:'buy',action:'ACCUMULATE',alloc:40,desc:'Deep value - accumulate on weakness',color:'#86efac'};
}

function fp(p){return p?'$'+Math.round(p).toLocaleString():'--'}

var state={price:0,ma:0,fg:50,fr:0,hr:false,rsi:50};

function render(){
  var price=state.price,ma=state.ma,fg=state.fg,fr=state.fr,hr=state.hr,rsi=state.rsi;

  var buyRes=calcBuyScore(price,ma,fg,hr,fr);
  var sellRes=calcSellScore(price,ma,fg,fr,rsi);
  var pricePct=buyRes.pricePct||0;
  var signal=getSignal(buyRes.score,sellRes.score,pricePct);

  // Cycle position based primarily on price vs 200W MA, adjusted by scores
  var baseCycle=pricePct<=-30?10:pricePct<=-20?20:pricePct<=-10?30:pricePct<=0?40:pricePct<=30?55:pricePct<=50?70:pricePct<=100?85:95;
  var cycle=Math.round(Math.max(0,Math.min(100,baseCycle+(sellRes.score-buyRes.score)*0.2)));

  // Historical context - based on price position + scores
  var hist;
  if(pricePct<=-20&&buyRes.score>=40){
    hist={period:'Nov 2022, Mar 2020, Dec 2018',result:'+200% to +1500%',acc:'95%'};
  }else if(pricePct<=0&&buyRes.score>=30){
    hist={period:'Jun 2022, Sep 2019, Jan 2019',result:'+50% to +300%',acc:'85%'};
  }else if(pricePct>=70&&sellRes.score>=30){
    hist={period:'Nov 2021, Apr 2021, Dec 2017',result:'Avoided -50% to -85%',acc:'90%'};
  }else if(pricePct>=50){
    hist={period:'Feb 2021, mid-2019',result:'Caution warranted',acc:'75%'};
  }else if(pricePct>30){
    hist={period:'Current: correction from highs',result:'Wait for better entry',acc:'--'};
  }else{
    hist={period:'Mid-cycle consolidation',result:'Variable',acc:'--'};
  }

  var html='<div class="container">';

  // Header
  html+='<div class="header">';
  html+='<h1>Bitcoin Bottom & Top Indicator</h1>';
  html+='<div class="price">'+fp(price)+'</div>';
  html+='<div class="price-sub">200 Week MA: '+fp(ma)+'</div>';
  html+='</div>';

  // Main Signal
  html+='<div class="signal-card '+signal.type+'">';
  html+='<div class="signal-type" style="color:'+signal.color+'">'+(signal.type==='buy'?'Bottom Indicator':signal.type==='sell'?'Top Indicator':'Market Status')+'</div>';
  html+='<div class="signal-action" style="color:'+signal.color+'">'+signal.action+'</div>';
  if(signal.alloc>0){
    html+='<div class="signal-allocation" style="color:'+signal.color+'">'+(signal.type==='buy'?'Deploy ':'Sell ')+signal.alloc+'%</div>';
  }
  html+='<div class="signal-desc">'+signal.desc+'</div>';

  // Gauge
  html+='<div class="gauge">';
  html+='<div class="gauge-bar"><div class="gauge-needle" style="left:'+cycle+'%"></div></div>';
  html+='<div class="gauge-labels"><span>BOTTOM</span><span>NEUTRAL</span><span>TOP</span></div>';
  html+='</div>';
  html+='<div class="gauge-value">Cycle Position: '+cycle+'/100</div>';
  html+='</div>';

  // Scores
  html+='<div class="scores">';
  html+='<div class="score-card buy-score">';
  html+='<div class="score-label" style="color:#22c55e">Buy Score</div>';
  html+='<div class="score-value" style="color:#22c55e">'+buyRes.score+'</div>';
  html+='<div class="score-max">/ 100</div>';
  html+='</div>';
  html+='<div class="score-card sell-score">';
  html+='<div class="score-label" style="color:#ef4444">Sell Score</div>';
  html+='<div class="score-value" style="color:#ef4444">'+sellRes.score+'</div>';
  html+='<div class="score-max">/ 100</div>';
  html+='</div>';
  html+='</div>';

  // Indicators
  html+='<div class="indicators">';
  var inds=signal.type==='sell'?sellRes.indicators:buyRes.indicators;
  for(var i=0;i<inds.length;i++){
    var ind=inds[i];
    var active=signal.type==='buy'?ind.buy:signal.type==='sell'?ind.sell:false;
    html+='<div class="indicator'+(active?' active-'+(signal.type==='sell'?'sell':'buy'):'')+'">';
    html+='<div class="ind-name">'+ind.name+'</div>';
    html+='<div class="ind-value" style="color:'+(active?(signal.type==='sell'?'#ef4444':'#22c55e'):'#94a3b8')+'">'+ind.value+'</div>';
    html+='<div class="ind-status" style="color:'+(active?(signal.type==='sell'?'#ef4444':'#22c55e'):'#64748b')+'">'+ind.status+' ('+ind.pts+'/'+ind.max+')</div>';
    html+='</div>';
  }
  html+='</div>';

  // Ladder (only if action)
  if(signal.alloc>0){
    html+='<div class="ladder">';
    html+='<div class="ladder-title">'+(signal.type==='buy'?'Buy':'Sell')+' Ladder Strategy</div>';
    html+='<div class="ladder-grid">';
    if(signal.type==='buy'){
      html+='<div class="ladder-item"><div class="ladder-label">Tranche 1</div><div class="ladder-price">'+fp(price)+'</div><div class="ladder-pct" style="color:#22c55e">40% Now</div></div>';
      html+='<div class="ladder-item"><div class="ladder-label">Tranche 2</div><div class="ladder-price">'+fp(price*0.95)+'</div><div class="ladder-pct" style="color:#86efac">30% @ -5%</div></div>';
      html+='<div class="ladder-item"><div class="ladder-label">Tranche 3</div><div class="ladder-price">'+fp(price*0.90)+'</div><div class="ladder-pct" style="color:#86efac">30% @ -10%</div></div>';
    }else{
      html+='<div class="ladder-item"><div class="ladder-label">Tranche 1</div><div class="ladder-price">'+fp(price)+'</div><div class="ladder-pct" style="color:#ef4444">40% Now</div></div>';
      html+='<div class="ladder-item"><div class="ladder-label">Tranche 2</div><div class="ladder-price">'+fp(price*1.10)+'</div><div class="ladder-pct" style="color:#fb923c">30% @ +10%</div></div>';
      html+='<div class="ladder-item"><div class="ladder-label">Tranche 3</div><div class="ladder-price">'+fp(price*1.20)+'</div><div class="ladder-pct" style="color:#fb923c">30% @ +20%</div></div>';
    }
    html+='</div></div>';
  }

  // Historical
  html+='<div class="historical">';
  html+='<div class="hist-title">Historical Performance</div>';
  html+='<div class="hist-grid">';
  html+='<div class="hist-item"><div class="hist-label">Similar Signals</div><div class="hist-value">'+hist.period+'</div></div>';
  html+='<div class="hist-item"><div class="hist-label">Result (12 months)</div><div class="hist-value" style="color:'+(signal.type==='buy'?'#22c55e':signal.type==='sell'?'#ef4444':'#94a3b8')+'">'+hist.result+'</div></div>';
  html+='<div class="hist-item"><div class="hist-label">Accuracy</div><div class="hist-value">'+hist.acc+'</div></div>';
  html+='<div class="hist-item"><div class="hist-label">Updated</div><div class="hist-value">'+new Date().toLocaleTimeString()+'</div></div>';
  html+='</div></div>';

  // Footer
  html+='<div class="footer">';
  html+='<div class="disclaimer"><strong>DISCLAIMER:</strong> Not financial advice. Past performance does not guarantee future results. Always manage risk appropriately.</div>';
  html+='<div>Data: Binance, CoinGecko, Alternative.me, Mempool.space</div>';
  html+='</div>';

  html+='</div>';
  document.getElementById('app').innerHTML=html;
}

function fetchAll(){
  return Promise.all([fetchPrice(),fetchMA(),fetchFG(),fetchFR(),fetchHR(),fetchRSI()]).then(function(r){
    state.price=r[0]||0;
    state.ma=r[1]||0;
    state.fg=r[2]||50;
    state.fr=r[3]||0;
    state.hr=r[4]||false;
    state.rsi=r[5]||50;
    render();
  });
}

fetchAll();
setInterval(function(){fetchPrice().then(function(p){state.price=p;render()})},30000);
setInterval(fetchAll,60000);
})();
</script>
</body>
</html>
